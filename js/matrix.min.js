function searchKeyUp(){TriggerSearch=!0}function applySearch(){const e=document.getElementById("feature-search").value.toUpperCase();let t=!1;const o=document.querySelectorAll("tr");for(const n of o){const o=-1!==n.className.indexOf("sticky-row");if(o)t=!1;else{const o=n.getElementsByTagName("td")[0];if(o){t&&-1==o.className.indexOf("indent")&&(t=!1);const c=o.textContent||o.innerText;c.toUpperCase().includes(e)||t?(n.classList.remove("hidden"),-1!==o.className.indexOf("group")&&(t=!0)):n.classList.add("hidden")}}}}function searchTimer(){TriggerSearch&&(TriggerSearch=!1,applySearch())}function setupFeatureSearch(){document.getElementById("feature-search").addEventListener("keyup",searchKeyUp)}function countInGroup(e,t){let o=0,n=0;for(let c=0;c<DIAGRAM_GROUPS.length;c+=1){if(c===e){const e=n+DIAGRAM_GROUPS[c];for(let c=n;c<e;c+=1)t[c]&&(o+=1);return o}n+=DIAGRAM_GROUPS[c]}return-1}function getSelectedCheckboxes(){const e=new Array(DIAGRAM_COUNT),t=document.querySelectorAll("input[type=checkbox]");for(const o of t)e[o.value]=o.checked;return e}function setSelectedCheckboxes(e){const t=document.querySelectorAll("input[type=checkbox]");for(const o of t)o.checked=e[o.value]}function findGroup(e,t){let o=0;for(let n=0;n<t.length;n+=1)if(o+=t[n],e<o)return n;return-1}function showColumns(e){const t=e.every(e=>!e),o=document.querySelectorAll("tr");for(let n=0;n<o.length;n+=1){const c=o[n];let r=!1,l=null;if(0===n){l=c.getElementsByTagName("th");for(let t=1;t<l.length;t+=1){const o=l[t],n=countInGroup(t-1,e);n>0?o.classList.remove("hidden"):o.classList.add("hidden"),o.setAttribute("colspan",n)}}else{const o=-1!==c.className.indexOf("sticky-row-3");1===n||o?l=c.getElementsByTagName("th"):(l=c.getElementsByTagName("td"),r=!t),o&&(r=!1);for(let t=1;t<l.length;t+=1){const o=l[t];e[t-1]?(o.classList.remove("hidden"),""!==o.textContent&&(r=!1)):o.classList.add("hidden")}r?c.classList.add("hidden"):c.classList.remove("hidden")}}""!==document.getElementById("feature-search").value&&applySearch()}function hashChanged(){const e=new Array(DIAGRAM_COUNT);e.fill(!0);let t=window.location.hash.substring(1);const o=Array.from(t).every(e=>"1"===e);if(!o&&(18===t.length&&(t=t[0]+"00"+t.slice(1,-4)+"0"+t.slice(-4)),t.length===DIAGRAM_COUNT))for(let o=0;o<t.length;o+=1)e[o]="1"===t[o];setSelectedCheckboxes(e),showColumns(e)}function checkboxChanged(){const e=getSelectedCheckboxes();let t="#";for(const o of e)t+=o?"1":"0";window.location.hash=t}function setupCheckboxes(){const e=document.querySelectorAll("input[type=checkbox]");for(const t of e)t.addEventListener("change",checkboxChanged)}function selectAll(){const e="#"+"1".repeat(DIAGRAM_COUNT);window.location.hash=e}function selectNone(){const e="#"+"0".repeat(DIAGRAM_COUNT);window.location.hash=e}function selectSave(){const e=getSelectedCheckboxes();let t="#";for(const o of e)t+=o?"1":"0";localStorage.setItem(StoreName.MatrixSelection,t),showModalDialog("Selection saved.<br/><br/>\n    When you return your selection will be applied automatically.",!1,void 0,"OK")}function exportClick(){const e=document.getElementById("features-table").cloneNode(!0),t=e.querySelector("#feature-search");""!==t.value?t.parentNode.innerText="Feature filter: "+t.value:t.remove();const o=e.getElementsByClassName("hidden");Array.from(o).forEach(e=>e.remove());const n=e.getElementsByClassName("indent1");Array.from(n).forEach(e=>{e.insertAdjacentText("afterBegin","> ")});const c=e.getElementsByClassName("indent2");Array.from(c).forEach(e=>{e.insertAdjacentText("afterBegin","> > ")});const r=e.querySelectorAll("td:not(:first-of-type)");Array.from(r).forEach(e=>{e.style.textAlign="center"});const l=e.querySelectorAll("th:first-of-type, td:first-of-type");Array.from(l).forEach(e=>{e.style.textAlign="left"});const s=e.querySelectorAll(".office>th, .office>td");Array.from(s).forEach(e=>{e.style.backgroundColor="#E82200",e.style.color="#FFFFFF"});const a=e.querySelectorAll(".ems>th, .ems>td");Array.from(a).forEach(e=>{e.style.backgroundColor="#2080A0",e.style.color="#FFFFFF"});const d=e.querySelectorAll(".windows>th, .windows>td");Array.from(d).forEach(e=>{e.style.backgroundColor="#006600",e.style.color="#FFFFFF"});const i=e.querySelectorAll(".suite>th, .suite>td");Array.from(i).forEach(e=>{e.style.backgroundColor="#7030A0",e.style.color="#FFFFFF"});const u='<html><head><base href="https://m365maps.com/"></head><body>'+e.outerHTML+"</body></html>",h=new Blob(["\ufeff",u],{type:"application/vnd.ms-excel"});downloadBlob(EXPORT_FILENAME,h)}function setupButtons(){document.getElementById("button-all").addEventListener("click",selectAll),document.getElementById("button-none").addEventListener("click",selectNone),document.getElementById("button-save").addEventListener("click",selectSave),document.getElementById("button-export").addEventListener("click",exportClick)}function applySavedSelectionHash(){if(""===window.location.hash){const e=localStorage.getItem(StoreName.MatrixSelection);e&&(window.location.hash=e)}}function DOMContentLoaded(){isEmbedded()&&(document.getElementById("menu").style.display="none"),setupModal(),setupButtons(),setupFeatureSearch(),setupCheckboxes(),applySavedSelectionHash(),window.addEventListener("hashchange",hashChanged),""!==window.location.hash&&hashChanged()}function pageLoad(){document.getElementById("header").style.width=document.body.scrollWidth+"px",setInterval(searchTimer,250)}let TriggerSearch=!1;const DIAGRAM_COUNT=21,DIAGRAM_GROUPS=[3,3,5,4,6],EXPORT_FILENAME="Microsoft-365-Matrix-Export.xls";document.addEventListener("DOMContentLoaded",DOMContentLoaded),window.addEventListener("load",pageLoad);